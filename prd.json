{
  "project": "oanim (open-animate)",
  "tickets": [
    {
      "id": "OANIM-001",
      "title": "Repo scaffolding + workspace config",
      "description": "Root package.json, pnpm-workspace.yaml, tsconfig.base.json, .gitignore, LICENSE, git init",
      "requirements": [
        "pnpm workspace with packages/* and examples/*",
        "TypeScript strict, ES2022 target, bundler moduleResolution",
        "Apache 2.0 license",
        "Git initialized with GitHub remote"
      ],
      "tests": [
        "pnpm install succeeds",
        "pnpm build succeeds from root"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-002",
      "title": "@oanim/core animation presets",
      "description": "Spring configs, easing presets, element animation helpers translated from Framer Motion to Remotion's frame-based API",
      "requirements": [
        "7 spring presets (snappy, bouncy, gentle, stiff, wobbly, smooth, poppy)",
        "5 easing presets wrapping Remotion Easing API",
        "8 element animations returning CSSProperties from {frame, fps, delay?, spring?}",
        "springValue() and springInterpolate() helpers"
      ],
      "tests": [
        "Package builds with tsup (ESM + CJS + DTS)",
        "Types export correctly",
        "Element animations return valid CSSProperties"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-003",
      "title": "@oanim/core scene transition presets",
      "description": "Custom TransitionPresentation implementations for @remotion/transitions TransitionSeries",
      "requirements": [
        "14 transitions: fadeBlur, scaleFade, clipCircle, clipPolygon, wipe, splitHorizontal, splitVertical, perspectiveFlip, morphExpand, zoomThrough, pushLeft, pushRight, slideLeft, slideRight",
        "wipe() accepts direction option",
        "All satisfy Remotion's TransitionPresentation<T extends Record<string, unknown>> constraint"
      ],
      "tests": [
        "TypeScript compiles with no errors",
        "Transitions work in TransitionSeries (verified in launch-video example)"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-004",
      "title": "@oanim/core typography components",
      "description": "Kinetic text components: AnimatedCharacters, TypewriterText, CountUp",
      "requirements": [
        "AnimatedCharacters: staggered per-character spring entrance",
        "TypewriterText: character-by-character reveal with blinking cursor",
        "CountUp: animated number counter with prefix/suffix/decimals"
      ],
      "tests": [
        "Components render without errors in Remotion",
        "Used in hello-world and launch-video examples"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-005",
      "title": "@oanim/core UI components + design tokens",
      "description": "Shared components (SafeArea, Background, GlowOrb, Terminal, Card, Badge, Grid, Vignette) and design tokens (colors, fonts, spacing)",
      "requirements": [
        "8 components with props documented via TypeScript interfaces",
        "5 color palettes (dark, light, midnight, sunset, ocean)",
        "Font stacks for heading, body, mono",
        "Spacing scale (xs through 5xl)"
      ],
      "tests": [
        "All components used in at least one example",
        "Package builds and exports all components"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-006",
      "title": "oanim init command",
      "description": "Scaffold a new Remotion project with @oanim/core pre-configured",
      "requirements": [
        "Creates directory with package.json, tsconfig, src/ files, scene.json",
        "Adds @oanim/core as dependency",
        "Detects pnpm/npm/yarn and auto-installs",
        "Generated project includes a working starter composition"
      ],
      "tests": [
        "oanim init test-project creates valid project structure",
        "Generated project builds and opens in remotion studio"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-007",
      "title": "oanim render command",
      "description": "Render composition to video using scene.json config with CLI overrides",
      "requirements": [
        "Reads scene.json for compositionId, render settings, props",
        "CLI flags override scene.json: --fps, --res, --codec, --out, --props",
        "Shells to npx remotion render with merged config",
        "Shows output stats (file size, resolution, codec)"
      ],
      "tests": [
        "oanim render in example project produces MP4",
        "CLI flag overrides work"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-008",
      "title": "oanim assets commands (fal.ai)",
      "description": "AI-powered asset generation: gen-image, edit-image, remove-bg, upscale via fal.ai API",
      "requirements": [
        "gen-image: text prompt → image file via fal-ai/flux/schnell",
        "edit-image: input image + prompt → edited image via fal-ai/flux/dev/image-to-image",
        "remove-bg: input image → transparent PNG via fal-ai/birefnet",
        "upscale: input image → 2x image via fal-ai/creative-upscaler",
        "OANIM_FAL_KEY env var required, clear error message if missing"
      ],
      "tests": [
        "Commands show correct --help output",
        "Error message shown when OANIM_FAL_KEY not set",
        "Live API test with valid key produces output files"
      ],
      "status": "done",
      "notes": "All 4 commands tested live — fixed response parsing for birefnet/creative-upscaler (image vs images)"
    },
    {
      "id": "OANIM-009",
      "title": "Hello World example",
      "description": "Minimal working Remotion project demonstrating @oanim/core presets",
      "requirements": [
        "Single-scene composition with animated text",
        "Uses fadeUp, popIn, Background, SafeArea, GlowOrb, Badge, AnimatedCharacters",
        "scene.json configured",
        "Part of pnpm workspace"
      ],
      "tests": [
        "npx remotion studio opens preview",
        "oanim render produces MP4"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-010",
      "title": "Launch Video example",
      "description": "Full 4-scene product launch video using TransitionSeries + oanim transitions",
      "requirements": [
        "4 scenes: Hook, ProductHero, Features, CTA",
        "Uses fadeBlur, scaleFade, clipCircle transitions",
        "Demonstrates Terminal, Card, Badge, AnimatedCharacters, TypewriterText",
        "15 seconds at 30fps (450 frames)"
      ],
      "tests": [
        "npx remotion studio opens preview",
        "oanim render produces MP4"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-011",
      "title": "Agent skill",
      "description": "SKILL.md + rules + example reference docs for agent workflow",
      "requirements": [
        "SKILL.md with overview, prerequisites, workflow",
        "5 rule files: workflow, scene-config, composition-patterns, animation-cookbook, asset-generation",
        "5 example references: launch-video, explainer, logo-reveal, meme-caption, investor-update"
      ],
      "tests": [
        "All files present and well-structured",
        "Animation cookbook covers all @oanim/core exports"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-012",
      "title": "Additional working examples",
      "description": "Runnable Remotion projects for explainer, logo-reveal, meme-caption, investor-update",
      "requirements": [
        "Each is a full Remotion project in examples/ with package.json, scene.json, src/",
        "Explainer: numbered step scenes with wipe transitions",
        "Logo reveal: 5s single-scene animation",
        "Meme caption: vertical 1080x1920 social clip",
        "Investor update: metrics with CountUp + Card components"
      ],
      "tests": [
        "Each project builds and opens in remotion studio",
        "Each renders to video via oanim render"
      ],
      "status": "done",
      "notes": "4 examples: logo-reveal, meme-caption, explainer, investor-update"
    },
    {
      "id": "OANIM-013",
      "title": "Root README.md",
      "description": "Public-facing README with quickstart, architecture overview, and package docs",
      "requirements": [
        "Project description and motivation",
        "Quickstart (install, init, preview, render)",
        "Architecture diagram",
        "Link to @oanim/core API reference",
        "Link to agent skill docs",
        "Contributing section",
        "License badge"
      ],
      "tests": [
        "Renders correctly on GitHub"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-014",
      "title": "Tag v0.1.0 release",
      "description": "Git tag and GitHub release for initial version",
      "requirements": [
        "All build passes",
        "README complete",
        "git tag v0.1.0",
        "GitHub release with changelog"
      ],
      "tests": [
        "Tag exists on remote",
        "GitHub release page shows correctly"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-015",
      "title": "Live fal.ai API testing",
      "description": "End-to-end test of all oanim assets subcommands with real API key",
      "requirements": [
        "gen-image produces valid PNG",
        "edit-image modifies input image",
        "remove-bg produces transparent PNG",
        "upscale produces 2x resolution image"
      ],
      "tests": [
        "All 4 commands produce valid output files",
        "Error handling works for invalid inputs"
      ],
      "status": "done",
      "notes": "All 4 commands verified live. Fixed response parsing bug (birefnet/creative-upscaler return image not images)."
    },
    {
      "id": "OANIM-016",
      "title": "End-to-end pipeline test",
      "description": "Full oanim init → write composition → remotion studio → oanim render pipeline test",
      "requirements": [
        "oanim init creates working project",
        "remotion studio opens without errors",
        "oanim render produces playable MP4"
      ],
      "tests": [
        "Scaffolded project renders successfully",
        "Example projects render successfully"
      ],
      "status": "done",
      "notes": "oanim init scaffolds correctly, pnpm build succeeds with all 6 examples in workspace"
    },
    {
      "id": "OANIM-017",
      "title": "ASCII art branding for CLI init + skill",
      "description": "Add splash ASCII art banner shown during oanim init, and in SKILL.md header",
      "requirements": [
        "splashBanner() with block-style ASCII art and indigo→violet gradient",
        "Shown at start of oanim init only",
        "Global preAction banner skipped for init command",
        "ASCII art code block added to top of SKILL.md"
      ],
      "tests": [
        "oanim init shows splash banner",
        "oanim --help / oanim render show small banner only",
        "pnpm build succeeds"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-018",
      "title": "Restructure repo for platform evolution",
      "description": "Rename scene.json → animate.json, OANIM_FAL_KEY → ANIMATE_FAL_KEY, skill/ → animate-skill/ with references/ + templates/ subdirs, rewrite CLAUDE.md with platform vision",
      "requirements": [
        "CLI reads animate.json instead of scene.json",
        "CLI reads ANIMATE_FAL_KEY instead of OANIM_FAL_KEY",
        "skill/ renamed to animate-skill/ with references/ and templates/ subdirs",
        "All 6 example scene.json renamed to animate.json",
        "CLAUDE.md rewritten with platform vision, naming conventions, planned packages",
        "prd.json updated with platform evolution tickets",
        "README.md updated with new naming",
        "pnpm build succeeds"
      ],
      "tests": [
        "pnpm build passes",
        "No stale scene.json or OANIM_FAL_KEY references in source"
      ],
      "status": "done"
    },
    {
      "id": "OANIM-019",
      "title": "Auth flow — oanim login",
      "description": "Browser-based OAuth login: oanim login opens browser, completes Clerk OAuth, stores credentials in ~/.oanim/credentials.yaml",
      "requirements": [
        "oanim login command opens browser for Clerk OAuth",
        "Local HTTP callback server receives token",
        "Credentials stored in ~/.oanim/credentials.yaml",
        "oanim whoami shows current user",
        "oanim logout clears credentials"
      ],
      "tests": [
        "oanim login completes OAuth flow and stores credentials",
        "oanim whoami displays user info",
        "oanim logout clears stored credentials"
      ],
      "status": "done",
      "notes": "login opens browser OAuth, whoami calls /api/v1/auth/me, logout clears ~/.oanim/credentials.yaml. login/whoami require backend to fully work."
    },
    {
      "id": "OANIM-020",
      "title": "Media gateway — multi-provider routing",
      "description": "packages/gateway/ — abstraction layer routing asset generation requests across providers (fal.ai first, then Runway, etc.) with usage metering and cost controls",
      "requirements": [
        "Provider adapter interface (generate, edit, removeBackground, upscale)",
        "fal.ai adapter (migrate existing fal.ts logic)",
        "Usage metering per request (provider, model, cost)",
        "Cost controls via ANIMATE_MAX_USD_PER_RUN env var",
        "CLI oanim assets routes through gateway"
      ],
      "tests": [
        "fal.ai adapter produces same results as direct integration",
        "Cost limit stops execution when exceeded",
        "Usage metrics recorded per request"
      ],
      "status": "done",
      "notes": "MediaGateway wraps FalProvider adapter. Cost tracking + ANIMATE_MAX_USD_PER_RUN limit. assets.ts refactored to use gateway."
    },
    {
      "id": "OANIM-021",
      "title": "API key resolution chain",
      "description": "Implement credential resolution: explicit param > ANIMATE_API_KEY env > ~/.oanim/credentials.yaml > direct provider key fallback (ANIMATE_FAL_KEY)",
      "requirements": [
        "Resolution chain: explicit param → ANIMATE_API_KEY env → credentials file → provider key fallback",
        "Works for both CLI and SDK usage",
        "Clear error messages when no credentials found",
        "Shared module in packages/auth/"
      ],
      "tests": [
        "Each level of the resolution chain works",
        "Fallback to direct provider key preserves backward compat",
        "Error message guides user to oanim login or env var setup"
      ],
      "status": "done",
      "notes": "config.ts in packages/cli/src/lib/. Resolution: ANIMATE_API_KEY env → credentials.yaml api_key → credentials.yaml token → null."
    },
    {
      "id": "OANIM-022",
      "title": "Cloud rendering — oanim render --cloud",
      "description": "Send composition to hosted rendering infrastructure, stream back MP4. Requires auth (OANIM-019) and API key resolution (OANIM-021)",
      "requirements": [
        "oanim render --cloud flag sends job to cloud API",
        "Streaming progress updates during render",
        "Downloads final MP4 to local --out path",
        "Falls back to local render on auth failure with clear message",
        "Usage metering for cloud render minutes"
      ],
      "tests": [
        "Cloud render produces same output as local render",
        "Progress streaming works",
        "Auth failure shows helpful error"
      ],
      "status": "done",
      "notes": "cloud-render.ts in packages/cli/src/lib/. --cloud flag on render command. Requires auth + backend API to function."
    },
    {
      "id": "OANIM-023",
      "title": "Backend auth endpoints",
      "description": "Backend API endpoints to support CLI auth flow: browser OAuth redirect and user info",
      "requirements": [
        "GET /api/v1/auth/cli/login?port={port} — Clerk OAuth redirect, callback to localhost:{port}/callback?token=...",
        "GET /api/v1/auth/me — returns { id, email, created_at } from JWT/API key",
        "API key creation/validation for programmatic access (ANIMATE_API_KEY)"
      ],
      "tests": [
        "oanim login completes full OAuth flow and stores token",
        "oanim whoami returns user info with stored token",
        "ANIMATE_API_KEY env var authenticates API requests"
      ],
      "status": "done",
      "notes": "Hono + Drizzle backend at packages/api/. Clerk OAuth → API key flow. jose JWKS verification. Replaced Convex with self-hostable stack in OANIM-030."
    },
    {
      "id": "OANIM-024",
      "title": "Backend cloud render endpoints",
      "description": "Backend API endpoints to support oanim render --cloud: accept project upload, render in sandboxed infra, return MP4",
      "requirements": [
        "POST /api/v1/render — accepts project tarball + config, returns { job_id }",
        "GET /api/v1/render/{job_id} — returns { status, progress, output_url?, error? }",
        "GET /api/v1/render/{job_id}/download — streams rendered MP4",
        "Sandboxed rendering environment (E2B or similar)",
        "Usage metering per render job"
      ],
      "tests": [
        "oanim render --cloud submits, polls, and downloads successfully",
        "Progress updates reflect actual render progress",
        "Large projects upload and render without timeout"
      ],
      "status": "done",
      "notes": "Remotion Lambda via pg-boss worker. CLI bundles locally (npx remotion bundle), uploads tarball to S3, worker deploys site to S3 and calls renderMediaOnLambda(). Replaced Convex with self-hostable stack in OANIM-030."
    },
    {
      "id": "OANIM-025",
      "title": "CLI unit tests",
      "description": "Vitest tests for new CLI modules: config resolution, media gateway cost limits, provider adapter, HTTP client",
      "requirements": [
        "Config: test credential resolution chain (env > api_key > token > null)",
        "Config: test YAML read/write with file permissions",
        "Gateway: test cost limit enforcement (ANIMATE_MAX_USD_PER_RUN)",
        "Gateway: test usage tracking accumulation",
        "Provider: test FalProvider request formatting and response parsing",
        "HTTP client: test auth header injection and error mapping"
      ],
      "tests": [
        "pnpm test passes with all new tests",
        "Coverage for config.ts, gateway.ts, providers/fal.ts, http.ts"
      ],
      "status": "planned"
    },
    {
      "id": "OANIM-026",
      "title": "npm publish — @oanim/core and oanim CLI",
      "description": "Publish packages to npm registry. Set up CI for automated releases.",
      "requirements": [
        "@oanim/core published with ESM + CJS + DTS",
        "oanim CLI published with bin entry",
        "npx oanim init works from fresh install",
        "GitHub Actions workflow for publish on tag push"
      ],
      "tests": [
        "npm install @oanim/core resolves and imports correctly",
        "npx oanim --help works",
        "npx oanim init scaffolds a working project"
      ],
      "status": "done",
      "notes": "Published @oanim/core@0.1.0 and oanim@0.1.0 to npm under @oanim org. Added publishConfig, repository, homepage, keywords. npx oanim init works from fresh install."
    },
    {
      "id": "OANIM-027",
      "title": "Usage reporting — gateway metrics to platform API",
      "description": "Send media gateway usage records to the platform API for metering, billing, and dashboard display",
      "requirements": [
        "Gateway sends usage records to POST /api/v1/usage after each operation",
        "Graceful degradation — usage reporting failures don't block asset generation",
        "Works with both API key and token auth",
        "Backend endpoint aggregates usage per user/day"
      ],
      "tests": [
        "Usage records sent after successful asset generation",
        "Asset generation still works if usage API is unreachable",
        "Dashboard shows usage history"
      ],
      "status": "done",
      "notes": "usageRecords table in Drizzle schema. POST /api/v1/usage bulk-inserts, GET /api/v1/usage returns daily aggregations. Gateway fire-and-forget reports after each track() with graceful degradation."
    },
    {
      "id": "OANIM-028",
      "title": "Additional media provider — Runway adapter",
      "description": "Second MediaProvider implementation for Runway ML, demonstrating multi-provider routing in the gateway",
      "requirements": [
        "RunwayProvider implements MediaProvider interface",
        "Gateway selects provider via --provider flag or config",
        "oanim assets gen-image --provider runway works",
        "Cost estimates for Runway models"
      ],
      "tests": [
        "Runway adapter produces valid output",
        "Provider selection flag works in CLI",
        "Cost tracking works across providers"
      ],
      "status": "planned"
    },
    {
      "id": "OANIM-029",
      "title": "API key management commands",
      "description": "CLI commands to create, list, and revoke platform API keys for programmatic access",
      "requirements": [
        "oanim api-keys create --name <name> — creates key, displays once",
        "oanim api-keys list — shows active keys with names and created dates",
        "oanim api-keys revoke <id> — revokes a key with confirmation",
        "Keys use anim_ prefix"
      ],
      "tests": [
        "Created key authenticates API requests",
        "Revoked key is rejected",
        "List shows all active keys"
      ],
      "status": "done",
      "notes": "CLI api-keys command with create/list/revoke subcommands. Backend: Drizzle apiKeys table with SHA-256 hashed keys, anim_ prefix, max 10 per user."
    },
    {
      "id": "OANIM-030",
      "title": "Replace Convex with Hono + Drizzle + pg-boss",
      "description": "Replace vendor-locked Convex backend with self-hostable stack: Hono HTTP server, Drizzle ORM + Postgres, pg-boss job queue, S3 storage. Preserves all REST API endpoints and CLI compatibility.",
      "requirements": [
        "Hono server with same REST API shape as Convex HTTP router",
        "Drizzle schema: users, apiKeys, renderJobs, loginStates (uuid PKs)",
        "pg-boss render job worker (replaces Convex actions)",
        "S3 for bundle tarballs + rendered MP4s (replaces Convex Storage)",
        "Clerk JWT + API key auth middleware (jose/JWKS)",
        "CLI cloud-render.ts sends storageKey instead of bundleStorageId",
        "docker-compose.yml for local Postgres",
        "drizzle-kit for migrations"
      ],
      "tests": [
        "pnpm build succeeds",
        "docker-compose up -d starts Postgres",
        "drizzle-kit migrate creates tables",
        "pnpm dev starts server on :8000",
        "curl localhost:8000/api/v1/auth/me returns 401"
      ],
      "status": "done",
      "notes": "Removed Convex dependency entirely. API package now fully self-hostable. Same REST endpoints, same CLI compatibility. pg-boss handles render jobs via Postgres (no Redis needed)."
    },
    {
      "id": "OANIM-031",
      "title": "Provision infrastructure and deploy API server",
      "description": "Set up all required cloud services, configure env vars, deploy the Hono API server, and verify the full CLI→API flow end-to-end.",
      "requirements": [
        "Clerk: create application, configure OAuth redirect URIs, get CLERK_DOMAIN + CLERK_PUBLISHABLE_KEY",
        "AWS S3: create oanim-renders bucket with appropriate CORS policy",
        "AWS IAM: create credentials scoped to S3 bucket + Lambda invocation",
        "Remotion Lambda: deploy render function via npx remotion lambda deploy, get REMOTION_FUNCTION_NAME",
        "Postgres: provision managed instance (Neon, Supabase, RDS, or similar)",
        "Run drizzle-kit migrate against production DB",
        "Deploy Hono API server to hosting provider (Fly.io, Railway, or similar)",
        "Set all env vars (DATABASE_URL, CLERK_DOMAIN, CLERK_PUBLISHABLE_KEY, AWS creds, S3_BUCKET, REMOTION_FUNCTION_NAME)",
        "Update CLI default API URL (ANIMATE_API_URL / config) to point to deployed server",
        "E2E verification: oanim login → oanim whoami → oanim api-keys create → oanim render --cloud"
      ],
      "tests": [
        "curl https://<api-domain>/health returns { ok: true }",
        "curl https://<api-domain>/api/v1/auth/me returns 401",
        "oanim login opens browser and completes OAuth flow",
        "oanim whoami returns user info",
        "oanim api-keys create --name test creates and returns a key",
        "oanim render --cloud submits, polls, and downloads MP4"
      ],
      "status": "done",
      "notes": "Deployed on Porter (api.oanim.dev). Infra: RDS Postgres, S3 (oanim-renders + remotionlambda-useast1-19p1q149s1), Clerk (factual-aphid-42), Remotion Lambda. Full E2E PASS: health, auth, API keys, usage, cloud rendering. Cloud render produces 1920x1080 h264 MP4."
    },
    {
      "id": "OANIM-032",
      "title": "Headless auth — oanim login --token",
      "description": "Allow agents and CI environments to authenticate without a browser by passing an API key directly via --token flag",
      "requirements": [
        "oanim login --token <anim_xxx> saves key to credentials.yaml",
        "Verifies key by calling GET /api/v1/auth/me before saving",
        "Shows user email on success, clear error on invalid key",
        "Browser OAuth flow remains the default (no --token)"
      ],
      "tests": [
        "oanim login --token anim_validkey saves and shows email",
        "oanim login --token anim_badkey shows auth error",
        "oanim login (no flag) still opens browser"
      ],
      "status": "done",
      "notes": "Added --token flag to login command. Verifies key via /auth/me before saving. Agents use: oanim login --token anim_xxx"
    },
    {
      "id": "OANIM-033",
      "title": "Free credit seeding on account creation",
      "description": "New users get $5.00 free credits on account creation. Backend tracks credit balance per user, returned in /auth/me response.",
      "requirements": [
        "creditBalanceUsd column on users table (default $5.00)",
        "Set to $5.00 on user creation in auth callback",
        "GET /api/v1/auth/me includes creditBalanceUsd in response",
        "POST /api/v1/usage deducts from credit balance"
      ],
      "tests": [
        "New user has $5.00 credit balance",
        "Usage posting deducts from balance",
        "/auth/me shows current balance"
      ],
      "status": "done",
      "notes": "creditBalanceUsd column on users (default $5.00). POST /usage deducts from balance. /auth/me includes credit_balance_usd."
    },
    {
      "id": "OANIM-034",
      "title": "Credit limit enforcement in gateway",
      "description": "Gateway checks remaining credit balance before operations. Blocks with helpful error when credits exhausted.",
      "requirements": [
        "GET /api/v1/usage/balance endpoint returns remaining credits",
        "Gateway checks balance before each operation (if authenticated)",
        "Clear error message when credits exhausted with upgrade URL",
        "Unauthenticated users unaffected (direct ANIMATE_FAL_KEY still works)"
      ],
      "tests": [
        "Operations blocked when balance is $0",
        "Error message includes upgrade instructions",
        "Direct fal.ai key users unaffected"
      ],
      "status": "done",
      "notes": "GET /usage/balance endpoint. Gateway fetches balance once, tracks locally, blocks when insufficient. Graceful degradation for unauthenticated/offline."
    },
    {
      "id": "OANIM-035",
      "title": "Documentation site",
      "description": "Mint docs site covering quickstart, CLI reference, @oanim/core API, agent skill usage, platform features (auth, credits, cloud rendering), and self-hosting guide",
      "requirements": [
        "Quickstart guide: install → init → preview → render",
        "CLI reference: all commands with flags and examples",
        "@oanim/core API: presets, transitions, typography, UI components, design tokens",
        "Agent skill docs: how to use animate-skill with Claude/Openclaw",
        "Platform docs: auth flow (browser + headless), API keys, free credits, usage/billing",
        "Cloud rendering guide: oanim render --cloud",
        "Self-hosting guide: docker-compose, env vars, Clerk setup, S3, Remotion Lambda"
      ],
      "tests": [
        "mint dev serves docs locally",
        "All pages render without errors",
        "Code examples are accurate and tested"
      ],
      "status": "done",
      "notes": "21-page Mintlify docs site at packages/docs/. Two tabs: Documentation (14 pages) and Platform (7 pages). Live at docs.open-animate.com. Comprehensive audit completed: fixed Terminal component API (lines prop, not children), added all missing UI component props, corrected default spring values per animation, fixed API key prefix (anim_ not oan_), added spring config values, added missing env vars to self-hosting, added Steps/Note components, added cost controls and credit depletion docs."
    },
    {
      "id": "OANIM-036",
      "title": "Fix pg-boss worker not processing render jobs",
      "description": "pg-boss registers the render worker on startup (confirmed in Porter logs), but boss.work() never invokes the handler. Jobs submitted via boss.send() stay in 'queued' state indefinitely. Tested across multiple deploys (v10-v12) with fresh jobs — same result.",
      "requirements": [
        "Diagnose why boss.work('render') handler is never called despite boss.send('render') succeeding",
        "Check pg-boss internal tables (pgboss.job) to verify job state",
        "Ensure pg-boss polling/LISTEN-NOTIFY works with RDS Postgres + SSL",
        "Worker picks up render jobs within seconds of submission",
        "End-to-end: oanim render --cloud produces MP4"
      ],
      "tests": [
        "Submit render job, status changes from 'queued' to 'rendering' within 10s",
        "Porter logs show '[worker] picked up job: ...'",
        "Full cloud render completes and produces downloadable MP4"
      ],
      "status": "done",
      "notes": "Root causes: (1) pg-boss v10 work() always passes array — handler needed ([job]) destructure. (2) teamSize option removed in v10. (3) Bundle was uploaded to wrong S3 bucket — switched to Remotion's getOrCreateBucket(). (4) Bucket needed public-read policy + BucketOwnerPreferred for ACLs. (5) Bundle index.html had absolute paths that don't resolve on S3 — rewrite to relative. (6) CLI needed mkdir for output directory. Fixed in commits d0604a2 through e2f2bb1."
    },
    {
      "id": "OANIM-037",
      "title": "Fix Clerk OAuth login flow for deployed API",
      "description": "Three bugs found during E2E verification of oanim login against api.oanim.dev",
      "requirements": [
        "Use forceRedirectUrl instead of deprecated afterSignInUrl (Clerk v5+)",
        "Handle callback without token via client-side token bridge page",
        "Fix http:// to https:// for callback URLs behind reverse proxy",
        "Pass email from Clerk client-side (JWTs don't include email by default)"
      ],
      "tests": [
        "oanim login completes full OAuth flow without 404",
        "User email saved to database correctly",
        "oanim whoami shows email and credits"
      ],
      "status": "done",
      "notes": "Fixed in commits 4bd797a and 30bf880. Three issues: (1) afterSignInUrl deprecated → forceRedirectUrl, (2) http:// origin behind LB → https:// via host header, (3) email not in JWT → extracted from window.Clerk.user client-side. Also added credit_balance_usd to whoami output."
    },
    {
      "id": "OANIM-038",
      "title": "Backend media gateway endpoints (fal.ai proxy)",
      "description": "Add /api/v1/media/* endpoints to the API server that proxy asset generation requests to fal.ai. The CLI PlatformProvider already calls these routes but they don't exist on the backend yet — only the direct ANIMATE_FAL_KEY path works.",
      "requirements": [
        "POST /api/v1/media/generate — proxy to fal.ai flux/schnell, return { url, provider, model, estimatedCostUsd }",
        "POST /api/v1/media/edit — proxy to fal.ai flux/dev/image-to-image",
        "POST /api/v1/media/remove-background — proxy to fal.ai birefnet",
        "POST /api/v1/media/upscale — proxy to fal.ai creative-upscaler",
        "All endpoints require auth (API key or JWT)",
        "Deduct from user credit balance per operation",
        "Record usage in usageRecords table"
      ],
      "tests": [
        "oanim assets gen-image works without ANIMATE_FAL_KEY (platform auth only)",
        "All 4 asset commands produce valid output via platform proxy",
        "Usage records created and credits deducted",
        "401 returned for unauthenticated requests"
      ],
      "status": "done",
      "notes": "Single FAL_KEY on server, users pay via credits. All 4 endpoints implemented + usage tracking + credit deduction. Tested: gen-image produces 1024x576 image via platform auth."
    },
    {
      "id": "OANIM-039",
      "title": "Generic fal.ai proxy + model cost table",
      "description": "Generic POST /api/v1/media/run endpoint that proxies any fal.ai model, plus oanim assets run CLI command. Shared cost lookup table with ~30 models and $0.05 default.",
      "requirements": [
        "Shared cost table with ~30 popular fal.ai models + DEFAULT_COST=$0.05",
        "POST /api/v1/media/run accepts { model, input }, proxies to fal.run/{model}",
        "Returns { url, result, provider, model, estimatedCostUsd }",
        "No prefix restriction on model names",
        "RunResult type + run() on MediaProvider interface",
        "FalProvider and PlatformProvider implement run()",
        "MediaGateway.run() with cost limit + credit balance checks",
        "oanim assets run --model <id> --input <json> [--out <path>]",
        "Existing 4 endpoints refactored to use getModelCost()"
      ],
      "tests": [
        "pnpm build succeeds",
        "oanim assets run --model fal-ai/flux/schnell --input '{\"prompt\":\"a sunset\"}' --out test.png produces image",
        "oanim assets gen-image still works (existing endpoints unchanged)",
        "Usage recorded in DB and credits deducted"
      ],
      "status": "done",
      "notes": "Shared costs.ts in both api and cli packages. API /run endpoint returns raw result + extracted URL. CLI run command with optional --out download."
    },
    {
      "id": "OANIM-040",
      "title": "Publish agent skills (skills.sh, ClawHub, etc.)",
      "description": "Package and publish the animate-skill as installable agent skills on skills.sh, ClawHub, and other agent skill registries so agents can discover and use oanim.",
      "requirements": [
        "Skill packaged in format required by each registry",
        "Published and discoverable on skills.sh",
        "Published and discoverable on ClawHub",
        "Skill includes oanim assets run for generic model access",
        "README/description optimized for agent discovery"
      ],
      "tests": [
        "Skill installable from each registry",
        "Agent can use skill to generate assets end-to-end"
      ],
      "status": "planned"
    },
    {
      "id": "OANIM-041",
      "title": "Create launch video and add to landing page",
      "description": "Create a polished launch/demo video using oanim itself, embed it on the castari-landing page as a hero element.",
      "requirements": [
        "Launch video created with oanim (dogfooding)",
        "Video showcases core workflow: init, preview, render, assets",
        "Embedded on landing page hero section",
        "Responsive video player, autoplay muted with controls"
      ],
      "tests": [
        "Video plays on landing page without layout shift",
        "Mobile-responsive"
      ],
      "status": "planned"
    },
    {
      "id": "OANIM-042",
      "title": "Stripe billing integration",
      "description": "Integrate Stripe for credit purchases and subscription billing. Users buy credits via Stripe checkout, webhook tops up creditBalanceUsd.",
      "requirements": [
        "Stripe Checkout session creation endpoint (POST /api/v1/billing/checkout)",
        "Stripe webhook handler (POST /api/v1/billing/webhook) tops up credits on payment_intent.succeeded",
        "Credit packages: $5, $20, $50 tiers",
        "Billing history endpoint (GET /api/v1/billing/history)",
        "oanim billing — shows credit balance + purchase history",
        "oanim billing buy — opens Stripe Checkout in browser (like oanim login flow)",
        "oanim billing buy --amount <5|20|50> — skip tier selection",
        "Webhook callback updates credits, CLI polls until confirmed"
      ],
      "tests": [
        "Stripe test-mode checkout completes and credits appear",
        "Webhook idempotent (duplicate events don't double-credit)",
        "oanim billing shows updated balance after purchase",
        "oanim billing buy opens browser and credits arrive"
      ],
      "status": "done",
      "notes": "Stripe Checkout sessions, webhook handler (checkout.session.completed/expired), payments table with status tracking, billing CLI (balance, buy --amount). Free-form dollar amounts ($5 min), 10% bonus credits on purchases >= $50. CLI shows checkout URL with 'send this to your human' message. Payment methods configured in Stripe Dashboard. E2E verified in test mode."
    },
    {
      "id": "OANIM-043",
      "title": "API rate limiting",
      "description": "Add rate limiting to the API to prevent abuse. Per-user limits on media endpoints, stricter limits on auth endpoints.",
      "requirements": [
        "Rate limiter middleware (token bucket or sliding window)",
        "Media endpoints: 60 req/min per user",
        "Auth endpoints: 10 req/min per IP",
        "429 response with Retry-After header",
        "Redis-backed for distributed rate limiting (or in-memory for single instance)"
      ],
      "tests": [
        "Requests beyond limit return 429",
        "Retry-After header present",
        "Different users have independent limits"
      ],
      "status": "done",
      "notes": "In-memory sliding window rate limiter. Factory function rateLimit({ windowMs, maxRequests, keyFn }). mediaRateLimit (60/min by user) on /media/*, authRateLimit (10/min by IP) on /auth/cli/*. CLI handles 429 with Retry-After. Periodic stale-entry cleanup."
    },
    {
      "id": "OANIM-044",
      "title": "Error monitoring (Sentry)",
      "description": "Add Sentry error tracking to the API server for production observability.",
      "requirements": [
        "Sentry SDK integrated in API server",
        "Unhandled exceptions captured with user context",
        "Source maps uploaded for readable stack traces",
        "Alert rules for error spikes"
      ],
      "tests": [
        "Thrown error appears in Sentry dashboard",
        "User ID attached to error events"
      ],
      "status": "planned"
    },
    {
      "id": "OANIM-045",
      "title": "CLI usage & account commands",
      "description": "Add oanim usage command for credit balance, spending history, and account overview — all in the terminal. Postpones dashboard web app.",
      "requirements": [
        "oanim usage — shows credit balance + summary of recent spending",
        "oanim usage history — full usage table (date, model, operation, cost) with optional --limit",
        "Formatted table output (columns aligned, costs right-aligned)",
        "Total spend shown at bottom",
        "Low-balance warning when credits < $1"
      ],
      "tests": [
        "oanim usage shows correct credit balance",
        "oanim usage history lists records matching API",
        "Works with both API key and token auth"
      ],
      "status": "done",
      "notes": "GET /usage/records?limit&offset&days endpoint for per-record detail. CLI: oanim usage (balance + 7-day summary), oanim usage history --limit --days (per-record table). table() helper in output.ts. Low-balance warning when < $1."
    }
  ]
}
